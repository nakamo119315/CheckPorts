# Feature Specification: ポート別アプリケーション表示CLI

**Feature Branch**: `001-port-app-viewer`
**Created**: 2026-01-02
**Status**: Draft
**Input**: User description: "起動中のWebアプリをわかりやすく表示するCLIアプリ。どのポート番号にどのアプリ（Reactのフロントエンドや.NETのバックエンドなど）なのかわかる情報をシンプルに表示して欲しい。止めて良いかの判断に必要な情報を表示して欲しい。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - ポート使用状況の一覧表示 (Priority: P1)

開発者として、現在使用中のポートとそこで動作しているアプリケーションの一覧を確認したい。これにより、どのサービスが起動しているかを素早く把握できる。

**Why this priority**: ポート使用状況の把握は本ツールの最も基本的な機能であり、他のすべての機能の基盤となる。

**Independent Test**: コマンドを実行し、現在リッスン中のポート一覧が表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** 複数のWebアプリケーションが異なるポートで起動している状態で、**When** ユーザーがコマンドを引数なしで実行する、**Then** リッスン中の全ポートとアプリ情報が一覧表示される
2. **Given** ポートをリッスンしているプロセスがない場合、**When** ユーザーがコマンドを実行する、**Then** 「アクティブなポートはありません」というメッセージが表示される

---

### User Story 2 - アプリケーション種別の識別表示 (Priority: P2)

開発者として、各ポートで動作しているアプリケーションの種類（React、Next.js、.NET、Node.js、Pythonなど）を確認したい。これにより、どのプロジェクトのどの部分が動いているかを判断できる。

**Why this priority**: アプリ種別の識別は、複数プロジェクトを同時に開発する際の混乱を防ぐ重要な機能。

**Independent Test**: 異なる種類のアプリケーション（Node.js、Python等）を起動し、それぞれの種別が正しく識別・表示されることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** Node.jsアプリがポート3000で起動している状態で、**When** ユーザーがコマンドを実行する、**Then** ポート3000の行にNode.js関連の情報が表示される
2. **Given** 複数種類のアプリ（React dev server、.NET API、Pythonサーバー）が起動している状態で、**When** ユーザーがコマンドを実行する、**Then** 各ポートに対応するアプリ種別が識別可能な形で表示される

---

### User Story 3 - プロセス停止判断のための詳細情報表示 (Priority: P3)

開発者として、特定のポートを使用しているプロセスを停止してよいかを判断するための情報を確認したい。これにより、誤って重要なプロセスを停止することを防げる。

**Why this priority**: 停止判断に必要な情報は安全なプロセス管理に不可欠だが、まず一覧表示と種別識別が必要。

**Independent Test**: 特定のポートについて詳細情報を表示し、プロセス名、コマンドライン、起動時刻などの停止判断に必要な情報が含まれることで独立してテスト可能。

**Acceptance Scenarios**:

1. **Given** アプリケーションが起動している状態で、**When** ユーザーがコマンドを実行する、**Then** 各プロセスについてプロセスID（PID）、コマンドライン、起動からの経過時間が表示される
2. **Given** 同じポートを複数のプロセスが使用している状態で、**When** ユーザーがコマンドを実行する、**Then** 各プロセスの情報が個別に表示される

---

### Edge Cases

- ポートをリッスンしているプロセスがない場合、空の結果ではなく適切なメッセージを表示する
- 権限不足でプロセス情報を取得できない場合、エラーではなく取得可能な情報のみ表示し、権限に関する注意を表示する
- 非常に多くのポートがリッスン状態の場合でも、見やすい形式で表示する
- プロセス情報が取得できない場合（例：プロセスが終了直後）、「情報取得不可」と表示する

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは現在リッスン中のすべてのTCPポートを検出できなければならない
- **FR-002**: システムは各ポートを使用しているプロセスのPID（プロセスID）を表示しなければならない
- **FR-003**: システムは各プロセスのコマンドライン（実行コマンド）を表示しなければならない
- **FR-004**: システムはプロセスの起動からの経過時間を人間が読みやすい形式で表示しなければならない
- **FR-005**: システムはプロセスのコマンドラインからアプリケーション種別を推測し表示しなければならない
- **FR-006**: システムは`--help`オプションで使用方法を表示しなければならない
- **FR-007**: システムは`--json`オプションで結果をJSON形式で出力しなければならない
- **FR-008**: システムは正常終了時に終了コード0、エラー時に非ゼロの終了コードを返さなければならない
- **FR-009**: システムはエラー発生時に具体的な原因と対処方法を含むメッセージを表示しなければならない
- **FR-010**: システムは結果をポート番号の昇順でソートして表示しなければならない

### Key Entities

- **Port**: ポート番号、プロトコル（TCP）、状態（LISTEN）
- **Process**: PID、プロセス名、コマンドライン、起動時刻、ユーザー
- **AppType**: 推測されたアプリケーション種別（Node.js、Python、.NET、Java、Go等）、推測根拠

## Clarifications

### Session 2026-01-02

- Q: 対象OSは何か？ → A: macOSのみ対応
- Q: 表示のソート順は？ → A: ポート番号の昇順
- Q: CLIコマンド名は？ → A: `ports`

## Assumptions

以下の前提条件に基づいて仕様を策定しています：

- **コマンド名**: `ports` として実行する
- **対象プラットフォーム**: macOSのみを対象とする
- **対象ポート**: TCPポートのみを対象とする（UDPは対象外）
- **対象状態**: LISTEN状態のポートのみを表示する（ESTABLISHED等は対象外）
- **アプリ種別推測**: コマンドライン文字列に含まれるキーワード（node、python、dotnet、java等）から推測する
- **権限**: 一般ユーザー権限で取得可能な情報のみを表示する。管理者権限が必要な場合はその旨を通知する
- **出力形式**: デフォルトは人間が読みやすいテーブル形式、`--json`で機械処理用JSON形式

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは1回のコマンド実行で全ポートの使用状況を確認できる
- **SC-002**: 表示結果から3秒以内に目的のポートとアプリを特定できる
- **SC-003**: アプリケーション種別の識別精度が一般的な開発環境（Node.js、Python、.NET、Java）で80%以上である
- **SC-004**: 停止判断に必要な情報（PID、コマンド、起動時間）が全プロセスについて表示される
- **SC-005**: 10個以上のポートがリッスン状態でも1秒以内に結果が表示される
